"use strict";var Jitamin={},HJ={components:{}};HJ.component=function(t,e){this.components[t]=e},HJ.render=function(){for(var t in this.components)for(var e=document.querySelectorAll(".js-"+t),i=0;i<e.length;i++){var o=this.components[t],a=new o(e[i],JSON.parse(e[i].dataset.params));a.render(),e[i].className=e[i].className+"-rendered"}},HJ.el=function(t){function e(t){var e="string"==typeof t?document.createElement(t):t;this.attr=function(t,i){return null!==i&&e.setAttribute(t,i),this},this.hide=function(){return e.style.display="none",this},this.show=function(){return e.style.display="block",this},this.toggle=function(){return"none"===e.style.display?this.show():this.hide(),this},this.click=function(t){return e.onclick=function(e){e.preventDefault(),t()},this},this.add=function(t){return e.appendChild(t),this},this.html=function(t){return e.innerHTML=t,this},this.text=function(t){return e.appendChild(document.createTextNode(t)),this},this["for"]=function(t,i){for(var o=0;o<i.length;o++){var a=i[o];if("object"!=typeof a)e.appendChild(HJ.el(t).text(a).build());else{var n=HJ.el(t);for(var r in a)r in this&&"function"==typeof this[r]?n[r](a[r]):n.attr(r,a[r]);e.appendChild(n.build())}}return this},this.build=function(){return e}}return new e(t)},Jitamin.Accordion=function(t){this.app=t},Jitamin.Accordion.prototype.listen=function(){$(document).on("click",".accordion-toggle",function(t){var e=$(this).parents(".accordion-section");t.preventDefault(),e.hasClass("accordion-collapsed")?(e.find(".accordion-content").show(),e.removeClass("accordion-collapsed")):(e.find(".accordion-content").hide(),e.addClass("accordion-collapsed"))})},Jitamin.App=function(){this.controllers={}},Jitamin.App.prototype.get=function(t){return this.controllers[t]},Jitamin.App.prototype.execute=function(){for(var t in Jitamin)if("App"!==t){var e=new Jitamin[t](this);this.controllers[t]=e,"function"==typeof e.execute&&e.execute(),"function"==typeof e.listen&&e.listen(),"function"==typeof e.focus&&e.focus(),"function"==typeof e.keyboardShortcuts&&e.keyboardShortcuts()}this.focus(),this.sidebarToggle(),this.chosen(),this.keyboardShortcuts(),this.datePicker(),this.autoComplete(),this.tagAutoComplete(),this.sliderToggle(),new Vue({el:"body"})},Jitamin.App.prototype.keyboardShortcuts=function(){var t=this;Mousetrap.bindGlobal("mod+enter",function(){var e=$("form");1==e.length?e.submit():e.length>1&&("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName?$(document.activeElement).parents("form").submit():t.get("Popover").isOpen()&&$("#popover-container form").submit())}),Mousetrap.bindGlobal("esc",function(){t.get("Popover").close(),t.get("Dropdown").close(),t.get("Slider").close()}),Mousetrap.bind("?",function(){t.get("Popover").open($("body").data("keyboard-shortcut-url"))})},Jitamin.App.prototype.focus=function(){$(document).on("focus",".auto-select",function(){$(this).select()}),$(document).on("mouseup",".auto-select",function(t){t.preventDefault()})},Jitamin.App.prototype.sidebarToggle=function(){$(document).on("click",".sidebar-toggle",function(t){var e=$(this).parents(".wrapper");t.preventDefault(),e.hasClass("wrapper-collapsed")?(e.find(".sidebar").show("slow"),e.removeClass("wrapper-collapsed")):(e.find(".sidebar").hide("slow"),e.addClass("wrapper-collapsed"))})},Jitamin.App.prototype.sliderToggle=function(){var t=this;$(document).on("click",".slider-menu",function(e){e.preventDefault();var i=$(".sidecontent");i.width()>0?t.get("Slider").close():t.get("Slider").open($(this).attr("href"))})},Jitamin.App.prototype.chosen=function(){$(".chosen-select").each(function(){var t=$(this).data("search-threshold");void 0===t&&(t=10),$(this).chosen({width:"180px",no_results_text:$(this).data("notfound"),disable_search_threshold:t})}),$(".select-auto-redirect").change(function(){var t=new RegExp($(this).data("redirect-regex"),"g");window.location=$(this).data("redirect-url").replace(t,$(this).val())})},Jitamin.App.prototype.datePicker=function(){var t=$("body"),e=t.data("js-date-format"),i=t.data("js-time-format"),o=t.data("js-lang");$.datepicker.setDefaults($.datepicker.regional[o]),$.timepicker.setDefaults($.timepicker.regional[o]),$(".form-date").datepicker({showOtherMonths:!0,selectOtherMonths:!0,dateFormat:e,constrainInput:!1}),$(".form-datetime").datetimepicker({dateFormat:e,timeFormat:i,constrainInput:!1})},Jitamin.App.prototype.tagAutoComplete=function(){$(".tag-autocomplete").select2({tags:!0})},Jitamin.App.prototype.autoComplete=function(){$(".autocomplete").each(function(){var t=$(this),e=t.data("dst-field"),i=t.data("dst-extra-field");""==$("#form-"+e).val()&&t.parent().find("button[type=submit]").attr("disabled","disabled"),t.autocomplete({source:t.data("search-url"),minLength:1,select:function(o,a){$("input[name="+e+"]").val(a.item.id),i&&$("input[name="+i+"]").val(a.item[i]),t.parent().find("button[type=submit]").removeAttr("disabled")}})})},Jitamin.App.prototype.hasId=function(t){return!!document.getElementById(t)},Jitamin.App.prototype.showLoadingIcon=function(){$("body").append('<span id="app-loading-icon">&nbsp;<i class="fa fa-spinner fa-spin"></i></span>')},Jitamin.App.prototype.hideLoadingIcon=function(){$("#app-loading-icon").remove()},Jitamin.App.prototype.formatDuration=function(t){return t>=86400?Math.round(t/86400)+"d":t>=3600?Math.round(t/3600)+"h":t>=60?Math.round(t/60)+"m":t+"s"},Jitamin.App.prototype.isVisible=function(){var t="";return"undefined"!=typeof document.hidden?t="visibilityState":"undefined"!=typeof document.mozHidden?t="mozVisibilityState":"undefined"!=typeof document.msHidden?t="msVisibilityState":"undefined"!=typeof document.webkitHidden&&(t="webkitVisibilityState"),""==t||"visible"==document[t]},Jitamin.AvgTimeColumnChart=function(t){this.app=t},Jitamin.AvgTimeColumnChart.prototype.execute=function(){this.app.hasId("analytic-avg-time-column")&&this.show()},Jitamin.AvgTimeColumnChart.prototype.show=function(){var t=$("#chart"),e=t.data("metrics"),i=[t.data("label")],o=[];for(var a in e)i.push(e[a].average),o.push(e[a].title);c3.generate({data:{columns:[i],type:"bar"},bar:{width:{ratio:.5}},axis:{x:{type:"category",categories:o},y:{tick:{format:this.app.formatDuration}}},legend:{show:!1}})},Jitamin.BoardCollapsedMode=function(t){this.app=t},Jitamin.BoardCollapsedMode.prototype.keyboardShortcuts=function(){var t=this;t.app.hasId("board")&&Mousetrap.bind("s",function(){t.toggle()})},Jitamin.BoardCollapsedMode.prototype.toggle=function(){var t=this;this.app.showLoadingIcon(),$.ajax({cache:!1,url:$('.filter-display-mode:not([style="display: none;"]) a').attr("href"),success:function(e){$(".filter-display-mode").toggle(),t.app.get("BoardDragAndDrop").refresh(e)}})},Jitamin.BoardColumnView=function(t){this.app=t},Jitamin.BoardColumnView.prototype.execute=function(){this.app.hasId("board")&&this.render()},Jitamin.BoardColumnView.prototype.listen=function(){var t=this;$(document).on("click",".board-toggle-column-view",function(){t.toggle($(this).data("column-id"))})},Jitamin.BoardColumnView.prototype.onBoardRendered=function(){this.render()},Jitamin.BoardColumnView.prototype.render=function(){var t=this;$(".board-column-header").each(function(){var e=$(this).data("column-id");localStorage.getItem("hidden_column_"+e)&&t.hideColumn(e)})},Jitamin.BoardColumnView.prototype.toggle=function(t){localStorage.getItem("hidden_column_"+t)?this.showColumn(t):this.hideColumn(t)},Jitamin.BoardColumnView.prototype.hideColumn=function(t){$(".board-column-"+t+" .board-column-expanded").hide(),$(".board-column-"+t+" .board-column-collapsed").show(),$(".board-column-header-"+t+" .board-column-expanded").hide(),$(".board-column-header-"+t+" .board-column-collapsed").show(),$(".board-column-header-"+t).each(function(){$(this).removeClass("board-column-compact"),$(this).addClass("board-column-header-collapsed")}),$(".board-column-"+t).each(function(){$(this).addClass("board-column-task-collapsed")}),$(".board-column-"+t+" .board-rotation").each(function(){$(this).css("width",$(".board-column-"+t).height())}),localStorage.setItem("hidden_column_"+t,1)},Jitamin.BoardColumnView.prototype.showColumn=function(t){$(".board-column-"+t+" .board-column-expanded").show(),$(".board-column-"+t+" .board-column-collapsed").hide(),$(".board-column-header-"+t+" .board-column-expanded").show(),$(".board-column-header-"+t+" .board-column-collapsed").hide(),$(".board-column-header-"+t).removeClass("board-column-header-collapsed"),$(".board-column-"+t).removeClass("board-column-task-collapsed"),0==localStorage.getItem("horizontal_scroll")&&$(".board-column-header-"+t).addClass("board-column-compact"),localStorage.removeItem("hidden_column_"+t)},Jitamin.BoardHorizontalScrolling=function(t){this.app=t},Jitamin.BoardHorizontalScrolling.prototype.execute=function(){this.app.hasId("board")&&this.render()},Jitamin.BoardHorizontalScrolling.prototype.listen=function(){var t=this;$(document).on("click",".filter-toggle-scrolling",function(e){e.preventDefault(),t.toggle()})},Jitamin.BoardHorizontalScrolling.prototype.keyboardShortcuts=function(){var t=this;t.app.hasId("board")&&Mousetrap.bind("c",function(){t.toggle()})},Jitamin.BoardHorizontalScrolling.prototype.onBoardRendered=function(){this.render()},Jitamin.BoardHorizontalScrolling.prototype.toggle=function(){var t=localStorage.getItem("horizontal_scroll")||1;localStorage.setItem("horizontal_scroll",0==t?1:0),this.render()},Jitamin.BoardHorizontalScrolling.prototype.render=function(){0==localStorage.getItem("horizontal_scroll")?($(".filter-wide").show(),$(".filter-compact").hide(),$("#board-container").addClass("board-container-compact"),$("#board th:not(.board-column-header-collapsed)").addClass("board-column-compact")):($(".filter-wide").hide(),$(".filter-compact").show(),$("#board-container").removeClass("board-container-compact"),$("#board th").removeClass("board-column-compact"))},Jitamin.BoardPolling=function(t){this.app=t},Jitamin.BoardPolling.prototype.execute=function(){if(this.app.hasId("board")){var t=parseInt($("#board").attr("data-check-interval"));t>0&&window.setInterval(this.check.bind(this),1e3*t)}},Jitamin.BoardPolling.prototype.check=function(){if(this.app.isVisible()&&!this.app.get("BoardDragAndDrop").savingInProgress){var t=this;this.app.showLoadingIcon(),$.ajax({cache:!1,url:$("#board").data("check-url"),statusCode:{200:function(e){t.app.get("BoardDragAndDrop").refresh(e)},304:function(){t.app.hideLoadingIcon()}}})}},Jitamin.BoardTask=function(t){this.app=t},Jitamin.BoardTask.prototype.listen=function(){var t=this;$(document).on("click",".task-board-change-assignee",function(e){e.preventDefault(),e.stopPropagation(),t.app.get("Popover").open($(this).data("url"))}),$(document).on("click",".task-board",function(t){"A"!=t.target.tagName&&"IMG"!=t.target.tagName&&(window.location=$(this).data("task-url"))})},Jitamin.BoardTask.prototype.keyboardShortcuts=function(){var t=this;t.app.hasId("board")&&Mousetrap.bind("n",function(){t.app.get("Popover").open($("#board").data("task-creation-url"))})},Jitamin.BurndownChart=function(t){this.app=t},Jitamin.BurndownChart.prototype.execute=function(){this.app.hasId("analytic-burndown")&&this.show()},Jitamin.BurndownChart.prototype.show=function(){for(var t=$("#chart"),e=t.data("metrics"),i=[[t.data("label-total")]],o=[],a=d3.time.format("%Y-%m-%d"),n=d3.time.format(t.data("date-format")),r=0;r<e.length;r++)for(var s=0;s<e[r].length;s++)0==r?i.push([e[r][s]]):(i[s+1].push(e[r][s]),s>0&&(void 0==i[0][r]&&i[0].push(0),i[0][r]+=e[r][s]),0==s&&o.push(n(a.parse(e[r][s]))));c3.generate({data:{columns:i},axis:{x:{type:"category",categories:o}}})},Jitamin.Calendar=function(t){this.app=t},Jitamin.Calendar.prototype.execute=function(){var t=$("#calendar");1==t.length&&this.show(t)},Jitamin.Calendar.prototype.show=function(t){t.fullCalendar({lang:$("body").data("js-lang"),editable:!0,eventLimit:!0,defaultView:"month",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},eventDrop:function(e){$.ajax({cache:!1,url:t.data("store-url"),contentType:"application/json",type:"POST",processData:!1,data:JSON.stringify({task_id:e.id,date_due:e.start.format()})})},viewRender:function(){var e=t.data("check-url"),i={start:t.fullCalendar("getView").start.format(),end:t.fullCalendar("getView").end.format()};for(var o in i)e+="&"+o+"="+i[o];$.getJSON(e,function(e){t.fullCalendar("removeEvents"),t.fullCalendar("addEventSource",e),t.fullCalendar("rerenderEvents")})}})},Jitamin.Category=function(t){this.app=t},Jitamin.Category.prototype.listen=function(){this.dragAndDrop()},Jitamin.Category.prototype.dragAndDrop=function(){var t=this;$(".draggable-row-handle").mouseenter(function(){$(this).parent().parent().addClass("draggable-item-hover")}).mouseleave(function(){$(this).parent().parent().removeClass("draggable-item-hover")}),$(".categories-table tbody").sortable({forcePlaceholderSize:!0,handle:"td:first i",helper:function(t,e){return e.children().each(function(){$(this).width($(this).width())}),e},stop:function(e,i){var o=i.item;o.removeClass("draggable-item-selected"),t.savePosition(o.data("category-id"),o.index()+1)},start:function(t,e){e.item.addClass("draggable-item-selected")}}).disableSelection()},Jitamin.Category.prototype.savePosition=function(t,e){var i=$(".categories-table").data("save-position-url"),o=this;this.app.showLoadingIcon(),$.ajax({cache:!1,url:i,contentType:"application/json",type:"POST",processData:!1,data:JSON.stringify({category_id:t,position:e}),complete:function(){o.app.hideLoadingIcon()}})},Jitamin.Column=function(t){this.app=t},Jitamin.Column.prototype.listen=function(){this.dragAndDrop()},Jitamin.Column.prototype.dragAndDrop=function(){var t=this;$(".draggable-row-handle").mouseenter(function(){$(this).parent().parent().addClass("draggable-item-hover")}).mouseleave(function(){$(this).parent().parent().removeClass("draggable-item-hover")}),$(".columns-table tbody").sortable({forcePlaceholderSize:!0,handle:"td:first i",helper:function(t,e){return e.children().each(function(){$(this).width($(this).width())}),e},stop:function(e,i){var o=i.item;o.removeClass("draggable-item-selected"),t.savePosition(o.data("column-id"),o.index()+1)},start:function(t,e){e.item.addClass("draggable-item-selected")}}).disableSelection()},Jitamin.Column.prototype.savePosition=function(t,e){var i=$(".columns-table").data("save-position-url"),o=this;this.app.showLoadingIcon(),$.ajax({cache:!1,url:i,contentType:"application/json",type:"POST",processData:!1,data:JSON.stringify({column_id:t,position:e}),complete:function(){o.app.hideLoadingIcon()}})},Jitamin.CumulativeFlowDiagram=function(t){this.app=t},Jitamin.CumulativeFlowDiagram.prototype.execute=function(){this.app.hasId("analytic-cfd")&&this.show()},Jitamin.CumulativeFlowDiagram.prototype.show=function(){for(var t=$("#chart"),e=t.data("metrics"),i=[],o=[],a=[],n=d3.time.format("%Y-%m-%d"),r=d3.time.format(t.data("date-format")),s=0;s<e.length;s++)for(var l=0;l<e[s].length;l++)0==s?(i.push([e[s][l]]),l>0&&o.push(e[s][l])):(i[l].push(e[s][l]),0==l&&a.push(r(n.parse(e[s][l]))));c3.generate({data:{columns:i,type:"area-spline",groups:[o]},axis:{x:{type:"category",categories:a}}})},Jitamin.Dropdown=function(t){this.app=t},Jitamin.Dropdown.prototype.listen=function(){var t=this;$(document).on("click",function(){t.close()}),$(document).on("click",".dropdown-menu",function(e){e.preventDefault(),e.stopImmediatePropagation(),t.close();var i=$(this).next("ul"),o=$(this).offset();$("body").append(jQuery("<div>",{id:"dropdown"})),i.clone().appendTo("#dropdown");var a=$("#dropdown ul");a.addClass("dropdown-submenu-open");var n=a.outerHeight(),r=a.outerWidth();o.top+n-$(window).scrollTop()<$(window).height()||$(window).scrollTop()+o.top<n?$(this).parents(".sidebar").length?a.css("top",o.top-5):a.css("top",o.top+$(this).height()):a.css("top",o.top-n-5),o.left+r>$(window).width()?a.css("left",o.left-r+$(this).outerWidth()):$(this).parents(".sidebar").length?a.css("left",$(".sidebar").width()):a.css("left",o.left)}),$(document).on("click",".dropdown-submenu-open li",function(t){$(t.target).is("li")&&$(this).find("a:visible")[0].click()})},Jitamin.Dropdown.prototype.close=function(){$("#dropdown").remove()},Jitamin.Dropdown.prototype.onPopoverOpened=function(){this.close()},Jitamin.FileUpload=function(t){this.app=t,this.files=[],this.currentFile=0},Jitamin.FileUpload.prototype.onPopoverOpened=function(){var t=document.getElementById("file-dropzone"),e=this;t&&(t.ondragover=t.ondragenter=function(t){t.stopPropagation(),t.preventDefault()},t.ondrop=function(t){t.stopPropagation(),t.preventDefault(),e.files=t.dataTransfer.files,e.show(),$("#file-error-max-size").hide()},$(document).on("click","#file-browser",function(t){t.preventDefault(),$("#file-form-element").get(0).click()}),$(document).on("click","#file-upload-button",function(t){t.preventDefault(),e.currentFile=0,e.checkFiles()}),$("#file-form-element").change(function(){e.files=document.getElementById("file-form-element").files,e.show(),$("#file-error-max-size").hide()}))},Jitamin.FileUpload.prototype.show=function(){if($("#file-list").remove(),this.files.length>0){$("#file-upload-button").prop("disabled",!1),$("#file-dropzone-inner").hide();for(var t=jQuery("<ul>",{id:"file-list"}),e=0;e<this.files.length;e++){var i=jQuery("<span>",{id:"file-percentage-"+e}).append("(0%)"),o=jQuery("<progress>",{id:"file-progress-"+e,value:0}),a=jQuery("<li>",{id:"file-label-"+e}).append(o).append("&nbsp;").append(this.files[e].name).append("&nbsp;").append(i);t.append(a)}$("#file-dropzone").append(t)}else $("#file-dropzone-inner").show()},Jitamin.FileUpload.prototype.checkFiles=function(){for(var t=parseInt($("#file-dropzone").data("max-size")),e=0;e<this.files.length;e++)if(this.files[e].size>t)return $("#file-error-max-size").show(),$("#file-label-"+e).addClass("file-error"),void $("#file-upload-button").prop("disabled",!0);this.uploadFiles()},Jitamin.FileUpload.prototype.uploadFiles=function(){this.files.length>0&&this.uploadFile(this.files[this.currentFile])},Jitamin.FileUpload.prototype.uploadFile=function(t){var e=document.getElementById("file-dropzone"),i=e.dataset.url,o=new XMLHttpRequest,a=new FormData;o.upload.addEventListener("progress",this.updateProgress.bind(this)),o.upload.addEventListener("load",this.transferComplete.bind(this)),o.open("POST",i,!0),a.append("files[]",t),o.send(a)},Jitamin.FileUpload.prototype.updateProgress=function(t){t.lengthComputable&&($("#file-progress-"+this.currentFile).val(t.loaded/t.total),$("#file-percentage-"+this.currentFile).text("("+Math.floor(t.loaded/t.total*100)+"%)"))},Jitamin.FileUpload.prototype.transferComplete=function(){if(this.currentFile++,this.currentFile<this.files.length)this.uploadFile(this.files[this.currentFile]);else{var t=$("#file-upload-button");t.prop("disabled",!0),t.parent().hide(),$("#file-done").show()}},Jitamin.Gantt=function(t){this.app=t,this.data=[],this.options={container:"#gantt-chart",showWeekends:!0,allowMoves:!0,allowResizes:!0,cellWidth:20,cellHeight:31,slideWidth:1e3,vHeaderWidth:200}},Jitamin.Gantt.prototype.execute=function(){this.app.hasId("gantt-chart")&&this.show()},Jitamin.Gantt.prototype.saveRecord=function(t){this.app.showLoadingIcon(),$.ajax({cache:!1,url:$(this.options.container).data("set-date-url"),contentType:"application/json",type:"POST",processData:!1,data:JSON.stringify(t),complete:this.app.hideLoadingIcon.bind(this)})},Jitamin.Gantt.prototype.show=function(){this.data=this.prepareData($(this.options.container).data("records"));var t=Math.floor(this.options.slideWidth/this.options.cellWidth+5),e=this.getDateRange(t),i=e[0],o=e[1],a=$(this.options.container),n=jQuery("<div>",{"class":"ganttview"});n.append(this.renderVerticalHeader()),n.append(this.renderSlider(i,o)),a.append(n),jQuery("div.ganttview-grid-row div.ganttview-grid-row-cell:last-child",a).addClass("last"),jQuery("div.ganttview-hzheader-days div.ganttview-hzheader-day:last-child",a).addClass("last"),jQuery("div.ganttview-hzheader-months div.ganttview-hzheader-month:last-child",a).addClass("last"),$(this.options.container).data("readonly")?(this.options.allowResizes=!1,this.options.allowMoves=!1):(this.listenForBlockResize(i),this.listenForBlockMove(i))},Jitamin.Gantt.prototype.renderVerticalHeader=function(){for(var t=jQuery("<div>",{"class":"ganttview-vtheader"}),e=jQuery("<div>",{"class":"ganttview-vtheader-item"}),i=jQuery("<div>",{"class":"ganttview-vtheader-series"}),o=0;o<this.data.length;o++){var a=jQuery("<span>").append(jQuery("<i>",{"class":"fa fa-info-circle tooltip",title:this.getVerticalHeaderTooltip(this.data[o])})).append("&nbsp;");"task"==this.data[o].type?a.append(jQuery("<a>",{href:this.data[o].link,title:this.data[o].title}).append(this.data[o].title)):a.append(jQuery("<a>",{href:this.data[o].board_link,title:$(this.options.container).data("label-board-link")}).append('<i class="fa fa-columns"></i>')).append("&nbsp;").append(jQuery("<a>",{href:this.data[o].gantt_link,title:$(this.options.container).data("label-gantt-link")}).append('<i class="fa fa-sliders"></i>')).append("&nbsp;").append(jQuery("<a>",{href:this.data[o].link}).append(this.data[o].title)),i.append(jQuery("<div>",{"class":"ganttview-vtheader-series-name"}).append(a))}return e.append(i),t.append(e),t},Jitamin.Gantt.prototype.renderSlider=function(t,e){var i=jQuery("<div>",{"class":"ganttview-slide-container"}),o=this.getDates(t,e);return i.append(this.renderHorizontalHeader(o)),i.append(this.renderGrid(o)),i.append(this.addBlockContainers()),this.addBlocks(i,t),i},Jitamin.Gantt.prototype.renderHorizontalHeader=function(t){var e=jQuery("<div>",{"class":"ganttview-hzheader"}),i=jQuery("<div>",{"class":"ganttview-hzheader-months"}),o=jQuery("<div>",{"class":"ganttview-hzheader-days"}),a=0;for(var n in t)for(var r in t[n]){var s=t[n][r].length*this.options.cellWidth;a+=s,i.append(jQuery("<div>",{"class":"ganttview-hzheader-month",css:{width:s-1+"px"}}).append($.datepicker.regional[$("body").data("js-lang")].monthNames[r]+" "+n));for(var l in t[n][r])o.append(jQuery("<div>",{"class":"ganttview-hzheader-day"}).append(t[n][r][l].getDate()))}return i.css("width",a+"px"),o.css("width",a+"px"),e.append(i).append(o),e},Jitamin.Gantt.prototype.renderGrid=function(t){var e=jQuery("<div>",{"class":"ganttview-grid"}),i=jQuery("<div>",{"class":"ganttview-grid-row"});for(var o in t)for(var a in t[o])for(var n in t[o][a]){var r=jQuery("<div>",{"class":"ganttview-grid-row-cell"});this.options.showWeekends&&this.isWeekend(t[o][a][n])&&r.addClass("ganttview-weekend"),i.append(r)}var s=jQuery("div.ganttview-grid-row-cell",i).length*this.options.cellWidth;i.css("width",s+"px"),e.css("width",s+"px");for(var l=0;l<this.data.length;l++)e.append(i.clone());return e},Jitamin.Gantt.prototype.addBlockContainers=function(){for(var t=jQuery("<div>",{"class":"ganttview-blocks"}),e=0;e<this.data.length;e++)t.append(jQuery("<div>",{"class":"ganttview-block-container"}));return t},Jitamin.Gantt.prototype.addBlocks=function(t,e){for(var i=jQuery("div.ganttview-blocks div.ganttview-block-container",t),o=0,a=0;a<this.data.length;a++){var n=this.data[a],r=this.daysBetween(n.start,n.end)+1,s=this.daysBetween(e,n.start),l=jQuery("<div>",{"class":"ganttview-block-text"}),d=jQuery("<div>",{"class":"ganttview-block tooltip"+(this.options.allowMoves?" ganttview-block-movable":""),title:this.getBarTooltip(n),css:{width:r*this.options.cellWidth-3+"px","margin-left":s*this.options.cellWidth+1+"px"}}).append(l);r>=2&&l.append(n.progress),d.data("record",n),this.setBarColor(d,n),jQuery(i[o]).append(d),o+=1}},Jitamin.Gantt.prototype.getVerticalHeaderTooltip=function(t){var e="";if("task"==t.type)e="<strong>"+t.column_title+"</strong> ("+t.progress+")<br/>"+t.title;else{var i=["project-manager","project-member"];for(var o in i){var a=i[o];if(!jQuery.isEmptyObject(t.users[a])){var n=jQuery("<ul>");for(var r in t.users[a])r&&n.append(jQuery("<li>").append(t.users[a][r]));e+="<p><strong>"+$(this.options.container).data("label-"+a)+"</strong></p>"+n[0].outerHTML}}}return e},Jitamin.Gantt.prototype.getBarTooltip=function(t){var e="";return t.not_defined?e=$(this.options.container).data("label-not-defined"):("task"==t.type&&(e="<strong>"+t.progress+"</strong><br/>"+$(this.options.container).data("label-assignee")+" "+(t.assignee?t.assignee:"")+"<br/>"),e+=$(this.options.container).data("label-start-date")+" "+$.datepicker.formatDate("yy-mm-dd",t.start)+"<br/>",e+=$(this.options.container).data("label-end-date")+" "+$.datepicker.formatDate("yy-mm-dd",t.end)),e},Jitamin.Gantt.prototype.setBarColor=function(t,e){e.not_defined?t.addClass("ganttview-block-not-defined"):(t.css("background-color",e.color.background),t.css("border-color",e.color.border),"0%"!=e.progress&&t.append(jQuery("<div>",{css:{"z-index":0,position:"absolute",top:0,bottom:0,"background-color":e.color.border,width:e.progress,opacity:.4}})))},Jitamin.Gantt.prototype.listenForBlockResize=function(t){var e=this;jQuery("div.ganttview-block",this.options.container).resizable({grid:this.options.cellWidth,handles:"e,w",delay:300,stop:function(){var i=jQuery(this);e.updateDataAndPosition(i,t),e.saveRecord(i.data("record"))}})},Jitamin.Gantt.prototype.listenForBlockMove=function(t){var e=this;jQuery("div.ganttview-block",this.options.container).draggable({axis:"x",delay:300,grid:[this.options.cellWidth,this.options.cellWidth],stop:function(){var i=jQuery(this);e.updateDataAndPosition(i,t),e.saveRecord(i.data("record"))}})},Jitamin.Gantt.prototype.updateDataAndPosition=function(t,e){var i=jQuery("div.ganttview-slide-container",this.options.container),o=i.scrollLeft(),a=t.offset().left-i.offset().left-1+o,n=t.data("record");n.not_defined=!1,this.setBarColor(t,n);var r=Math.round(a/this.options.cellWidth),s=this.addDays(this.cloneDate(e),r);n.start=s;var l=t.outerWidth(),d=Math.round(l/this.options.cellWidth)-1;n.end=this.addDays(this.cloneDate(s),d),"task"===n.type&&d>0&&jQuery("div.ganttview-block-text",t).text(n.progress),t.attr("title",this.getBarTooltip(n)),t.data("record",n),t.css("top","").css("left","").css("position","relative").css("margin-left",a+"px")},Jitamin.Gantt.prototype.getDates=function(t,e){var i=[];i[t.getFullYear()]=[],i[t.getFullYear()][t.getMonth()]=[t];for(var o=t;this.compareDate(o,e)==-1;){var a=this.addDays(this.cloneDate(o),1);i[a.getFullYear()]||(i[a.getFullYear()]=[]),i[a.getFullYear()][a.getMonth()]||(i[a.getFullYear()][a.getMonth()]=[]),i[a.getFullYear()][a.getMonth()].push(a),o=a}return i},Jitamin.Gantt.prototype.prepareData=function(t){for(var e=0;e<t.length;e++){var i=new Date(t[e].start[0],t[e].start[1]-1,t[e].start[2],0,0,0,0);t[e].start=i;var o=new Date(t[e].end[0],t[e].end[1]-1,t[e].end[2],0,0,0,0);t[e].end=o}return t},Jitamin.Gantt.prototype.getDateRange=function(t){for(var e=new Date,i=new Date,o=0;o<this.data.length;o++){var a=new Date;a.setTime(Date.parse(this.data[o].start));var n=new Date;n.setTime(Date.parse(this.data[o].end)),0==o&&(e=a,i=n),1==this.compareDate(e,a)&&(e=a),this.compareDate(i,n)==-1&&(i=n)}return this.daysBetween(e,i)<t&&(i=this.addDays(this.cloneDate(e),t)),e.setDate(e.getDate()-1),[e,i]},Jitamin.Gantt.prototype.daysBetween=function(t,e){if(!t||!e)return 0;for(var i=0,o=this.cloneDate(t);this.compareDate(o,e)==-1;)i+=1,this.addDays(o,1);return i},Jitamin.Gantt.prototype.isWeekend=function(t){return t.getDay()%6==0},Jitamin.Gantt.prototype.cloneDate=function(t){return new Date(t.getTime())},Jitamin.Gantt.prototype.addDays=function(t,e){return t.setDate(t.getDate()+1*e),t},Jitamin.Gantt.prototype.compareDate=function(t,e){if(isNaN(t)||isNaN(e))throw new Error(t+" - "+e);if(t instanceof Date&&e instanceof Date)return t<e?-1:t>e?1:0;throw new TypeError(t+" - "+e)},Jitamin.LeadCycleTimeChart=function(t){this.app=t},Jitamin.LeadCycleTimeChart.prototype.execute=function(){this.app.hasId("analytic-lead-cycle-time")&&this.show()},Jitamin.LeadCycleTimeChart.prototype.show=function(){var t=$("#chart"),e=t.data("metrics"),i=[t.data("label-cycle")],o=[t.data("label-lead")],a=[],n={};n[t.data("label-cycle")]="area",n[t.data("label-lead")]="area-spline";var r={};r[t.data("label-lead")]="#afb42b",r[t.data("label-cycle")]="#4e342e";for(var s=0;s<e.length;s++)i.push(parseInt(e[s].avg_cycle_time)),o.push(parseInt(e[s].avg_lead_time)),a.push(e[s].day);c3.generate({data:{columns:[o,i],types:n,colors:r},axis:{x:{type:"category",categories:a},y:{tick:{format:this.app.formatDuration}}}})},Jitamin.Markdown=function(t){this.app=t,this.editor=null},Jitamin.Markdown.prototype.onPopoverOpened=function(){this.listen()},Jitamin.Markdown.prototype.onPopoverClosed=function(){this.listen()},Jitamin.Markdown.prototype.listen=function(){var t=$(".markdown-editor");this.editor&&this.destroy(),t.length>0&&this.show(t[0])},Jitamin.Markdown.prototype.destroy=function(){var t=this.editor.codemirror,e=t.getWrapperElement();for(var i in["toolbar","statusbar","sideBySide"])this.editor.gui[i]&&e.parentNode.removeChild(this.editor.gui[i]);t.toTextArea(),this.editor=null},Jitamin.Markdown.prototype.show=function(t){var e=["bold","italic","strikethrough","heading","|","unordered-list","ordered-list","link","|","code","table"];this.editor=new SimpleMDE({element:t,status:!1,toolbarTips:!1,autoDownloadFontAwesome:!1,spellChecker:!1,autosave:{enabled:!1},forceSync:!0,blockStyles:{italic:"_"},toolbar:!t.hasAttribute("data-markdown-editor-disable-toolbar")&&e,placeholder:t.getAttribute("placeholder")})},Jitamin.Popover=function(t){this.app=t},Jitamin.Popover.prototype.listen=function(){var t=this;$(document).on("click",".popover",function(e){t.onClick(e)}),$(document).on("click",".close-popover",function(e){t.close(e)}),$(document).on("click","#popover-content",function(t){t.stopPropagation()})},Jitamin.Popover.prototype.onClick=function(t){t.preventDefault(),t.stopPropagation();var e,i=t.currentTarget||t.target,o=i.getAttribute("href");o||(o=i.getAttribute("data-href")),e=$(i).hasClass("small")?"small":$(i).hasClass("large")?"large":"medium",o&&this.open(o,e)},Jitamin.Popover.prototype.isOpen=function(){return $("#popover-container").size()>0},Jitamin.Popover.prototype.open=function(t,e){var i=this;"undefined"==typeof e&&(e="medium"),i.isOpen()||$.get(t,function(t){$("body").css("overflow","hidden").prepend('<div id="popover-container"><div id="popover-content" class="'+e+'">'+t+"</div></div>"),$("#popover-content h2").eq(0).append('<a href="#" class="pull-right close-popover"><i class="fa fa-close"></i></a>'),i.executeOnOpenedListeners()})},Jitamin.Popover.prototype.close=function(t){this.isOpen()&&(t&&t.preventDefault(),$("#popover-container").remove(),$("body").css("overflow","initial"),this.executeOnClosedListeners())},Jitamin.Popover.prototype.ajaxReload=function(t,e,i){var o=e.getResponseHeader("X-Ajax-Redirect");"self"===o?window.location.reload():o&&o.indexOf("#")>-1?window.location=o.split("#")[0]:o?window.location=o:($("#popover-content").html(t),$("#popover-content input[autofocus]").focus(),i.executeOnOpenedListeners())},Jitamin.Popover.prototype.executeOnOpenedListeners=function(){for(var t in this.app.controllers){var e=this.app.get(t);"function"==typeof e.onPopoverOpened&&e.onPopoverOpened()}this.afterOpen()},Jitamin.Popover.prototype.executeOnClosedListeners=function(){for(var t in this.app.controllers){var e=this.app.get(t);"function"==typeof e.onPopoverClosed&&e.onPopoverClosed()}},Jitamin.Popover.prototype.afterOpen=function(){var t=this,e=$("#popover-content .popover-form");e&&e.on("submit",function(i){i.preventDefault(),$.ajax({type:"POST",url:e.attr("action"),data:e.serialize(),success:function(e,i,o){t.ajaxReload(e,o,t)},beforeSend:function(){var t=$('.popover-form button[type="submit"]');t.html('<i class="fa fa-spinner fa-pulse"></i> '+t.html()),t.attr("disabled",!0)}})}),$(document).on("click",".popover-link",function(e){e.preventDefault(),$.ajax({type:"GET",url:$(this).attr("href"),success:function(e,i,o){t.ajaxReload(e,o,t)}})}),$("[autofocus]").each(function(){
$(this).focus()}),this.app.datePicker(),this.app.autoComplete(),this.app.tagAutoComplete(),new Vue({el:"#popover-container"}),HJ.render()},Jitamin.ProjectCreation=function(t){this.app=t},Jitamin.ProjectCreation.prototype.onPopoverOpened=function(){$("#project-creation-form #form-src_project_id").on("change",function(){var t=$(this).val();0==t?$(".project-creation-options").hide():$(".project-creation-options").show()})},Jitamin.ProjectPermission=function(t){this.app=t},Jitamin.ProjectPermission.prototype.listen=function(){$(".project-change-role").on("change",function(){$.ajax({cache:!1,url:$(this).data("url"),contentType:"application/json",type:"POST",processData:!1,data:JSON.stringify({id:$(this).data("id"),role:$(this).val()})})})},Jitamin.Screenshot=function(t){this.app=t,this.pasteCatcher=null},Jitamin.Screenshot.prototype.onPopoverOpened=function(){this.app.hasId("screenshot-zone")&&this.initialize()},Jitamin.Screenshot.prototype.onPopoverClosed=function(){this.destroy()},Jitamin.Screenshot.prototype.initialize=function(){this.destroy(),window.Clipboard||(this.pasteCatcher=document.createElement("div"),this.pasteCatcher.id="screenshot-pastezone",this.pasteCatcher.contentEditable="true",this.pasteCatcher.style.opacity=0,this.pasteCatcher.style.position="fixed",this.pasteCatcher.style.top=0,this.pasteCatcher.style.right=0,this.pasteCatcher.style.width=0,document.body.insertBefore(this.pasteCatcher,document.body.firstChild),this.pasteCatcher.focus(),document.addEventListener("click",this.setFocus.bind(this)),document.getElementById("screenshot-zone").addEventListener("click",this.setFocus.bind(this))),window.addEventListener("paste",this.pasteHandler.bind(this))},Jitamin.Screenshot.prototype.destroy=function(){null!=this.pasteCatcher?document.body.removeChild(this.pasteCatcher):document.getElementById("screenshot-pastezone")&&document.body.removeChild(document.getElementById("screenshot-pastezone")),document.removeEventListener("click",this.setFocus.bind(this)),this.pasteCatcher=null},Jitamin.Screenshot.prototype.setFocus=function(){null!==this.pasteCatcher&&this.pasteCatcher.focus()},Jitamin.Screenshot.prototype.pasteHandler=function(t){if(t.clipboardData&&t.clipboardData.items){var e=t.clipboardData.items;if(e)for(var i=0;i<e.length;i++)if(e[i].type.indexOf("image")!==-1){var o=e[i].getAsFile(),a=new FileReader,n=this;a.onload=function(t){n.createImage(t.target.result)},a.readAsDataURL(o)}}else setTimeout(this.checkInput.bind(this),100)},Jitamin.Screenshot.prototype.checkInput=function(){var t=this.pasteCatcher.childNodes[0];t&&"IMG"===t.tagName&&this.createImage(t.src),this.pasteCatcher.innerHTML=""},Jitamin.Screenshot.prototype.createImage=function(t){var e=new Image;e.src=t,e.onload=function(){var e=t.split("base64,"),i=e[1];$("input[name=screenshot]").val(i)};var i=document.getElementById("screenshot-zone");i.innerHTML="",i.className="screenshot-pasted",i.appendChild(e),this.destroy(),this.initialize()},Jitamin.Search=function(t){this.app=t},Jitamin.Search.prototype.focus=function(){$(document).on("focus","#form-q",function(){var t=$("#form-q");if(t[0].setSelectionRange){var e=2*t.val().length;t[0].setSelectionRange(e,e)}})},Jitamin.Search.prototype.listen=function(){$(document).on("click",".filter-helper",function(t){t.preventDefault();var e=$(this).data("filter"),i=$(this).data("append-filter"),o=$(this).data("unique-filter"),a=$("#form-q");if(o){var n=o.substr(0,o.indexOf(":"));e=a.val().replace(new RegExp("("+n+":[#a-z0-9]+)","g"),""),e=e.replace(new RegExp("("+n+':"(.+)")',"g"),""),e=e.trim(),e+=" "+o}else i&&(e=a.val()+" "+i);a.val(e),$("form.search").submit()})},Jitamin.Search.prototype.goToView=function(t){var e=$(t);e.length&&(window.location=e.attr("href"))},Jitamin.Search.prototype.keyboardShortcuts=function(){var t=this;Mousetrap.bind("v o",function(){t.goToView(".view-overview")}),Mousetrap.bind("v b",function(){t.goToView(".view-board")}),Mousetrap.bind("v c",function(){t.goToView(".view-calendar")}),Mousetrap.bind("v l",function(){t.goToView(".view-listing")}),Mousetrap.bind("v g",function(){t.goToView(".view-gantt")}),Mousetrap.bind("f",function(t){t.preventDefault();var e=document.getElementById("form-q");e&&e.focus()}),Mousetrap.bind("r",function(t){t.preventDefault();var e=$(".filter-reset").data("filter"),i=$("#form-q");i.val(e),$("form.search").submit()})},Jitamin.Session=function(t){this.app=t},Jitamin.Session.prototype.execute=function(){window.setInterval(this.checkSession,6e4)},Jitamin.Session.prototype.checkSession=function(){$(".form-login").length||$.ajax({cache:!1,url:$("body").data("status-url"),statusCode:{401:function(){window.location=$("body").data("login-url")}}})},Jitamin.Skin=function(t){this.app=t},Jitamin.Skin.prototype.listen=function(){this.changeSkin(),this.changeLayout()},Jitamin.Skin.prototype.changeSkin=function(){$("#form-skin, #form-application_skin").on("change",function(){$("body").removeClass(),$("body").addClass("skin-"+$(this).find(":selected").val())})},Jitamin.Skin.prototype.changeLayout=function(){$("#form-layout, #form-application_layout").on("change",function(){$("body").removeClass("fluid fixed"),$("body").addClass($(this).find(":selected").val())})},Jitamin.Slider=function(t){this.app=t},Jitamin.Slider.prototype.isOpen=function(){return $(".sidecontent").width()>0},Jitamin.Slider.prototype.open=function(t){var e=this;e.isOpen()||$.get(t,function(t){var i=$(".sidecontent");i.addClass("active").html(t),$(".sidebar .slider").parent().addClass("active"),$(".content-panel").on("click",function(){e.close()})})},Jitamin.Slider.prototype.close=function(t){this.isOpen()&&(t&&t.preventDefault(),$(".sidecontent").removeClass("active").html(),$(".sidebar .slider").parent().removeClass("active"),this.executeOnClosedListeners())},Jitamin.Slider.prototype.executeOnClosedListeners=function(){for(var t in this.app.controllers){var e=this.app.get(t);"function"==typeof e.onPopoverClosed&&e.onPopoverClosed()}},Jitamin.Subtask=function(t){this.app=t},Jitamin.Subtask.prototype.listen=function(){var t=this;this.dragAndDrop(),$(document).on("click",".subtask-toggle-status",function(e){var i=$(this);e.preventDefault(),$.ajax({cache:!1,url:i.attr("href"),success:function(e){i.hasClass("subtask-refresh-table")?$(".subtasks-table").replaceWith(e):i.replaceWith(e),t.dragAndDrop()}})}),$(document).on("click",".subtask-toggle-timer",function(e){var i=$(this);e.preventDefault(),$.ajax({cache:!1,url:i.attr("href"),success:function(e){$(".subtasks-table").replaceWith(e),t.dragAndDrop()}})})},Jitamin.Subtask.prototype.dragAndDrop=function(){var t=this;$(".draggable-row-handle").mouseenter(function(){$(this).parent().parent().addClass("draggable-item-hover")}).mouseleave(function(){$(this).parent().parent().removeClass("draggable-item-hover")}),$(".subtasks-table tbody").sortable({forcePlaceholderSize:!0,handle:"td:first i",helper:function(t,e){return e.children().each(function(){$(this).width($(this).width())}),e},stop:function(e,i){var o=i.item;o.removeClass("draggable-item-selected"),t.savePosition(o.data("subtask-id"),o.index()+1)},start:function(t,e){e.item.addClass("draggable-item-selected")}}).disableSelection()},Jitamin.Subtask.prototype.savePosition=function(t,e){var i=$(".subtasks-table").data("save-position-url"),o=this;this.app.showLoadingIcon(),$.ajax({cache:!1,url:i,contentType:"application/json",type:"POST",processData:!1,data:JSON.stringify({subtask_id:t,position:e}),complete:function(){o.app.hideLoadingIcon()}})},Jitamin.Swimlane=function(t){this.app=t},Jitamin.Swimlane.prototype.execute=function(){$(".swimlanes-table").length&&this.dragAndDrop()},Jitamin.Swimlane.prototype.listen=function(){var t=this;$(document).on("click",".board-swimlane-toggle",function(e){e.preventDefault();var i=$(this).data("swimlane-id");t.isCollapsed(i)?t.expand(i):t.collapse(i)})},Jitamin.Swimlane.prototype.onBoardRendered=function(){for(var t=this.getAllCollapsed(),e=0;e<t.length;e++)this.collapse(t[e])},Jitamin.Swimlane.prototype.getStorageKey=function(){return"hidden_swimlanes_"+$("#board").data("project-id")},Jitamin.Swimlane.prototype.expand=function(t){var e=this.getAllCollapsed(),i=e.indexOf(t);i>-1&&e.splice(i,1),localStorage.setItem(this.getStorageKey(),JSON.stringify(e)),$(".board-swimlane-columns-"+t).css("display","table-row"),$(".board-swimlane-tasks-"+t).css("display","table-row"),$(".hide-icon-swimlane-"+t).css("display","inline"),$(".show-icon-swimlane-"+t).css("display","none")},Jitamin.Swimlane.prototype.collapse=function(t){var e=this.getAllCollapsed();e.indexOf(t)<0&&(e.push(t),localStorage.setItem(this.getStorageKey(),JSON.stringify(e))),$(".board-swimlane-columns-"+t+":not(:first-child)").css("display","none"),$(".board-swimlane-tasks-"+t).css("display","none"),$(".hide-icon-swimlane-"+t).css("display","none"),$(".show-icon-swimlane-"+t).css("display","inline")},Jitamin.Swimlane.prototype.isCollapsed=function(t){return this.getAllCollapsed().indexOf(t)>-1},Jitamin.Swimlane.prototype.getAllCollapsed=function(){return JSON.parse(localStorage.getItem(this.getStorageKey()))||[]},Jitamin.Swimlane.prototype.dragAndDrop=function(){var t=this;$(".draggable-row-handle").mouseenter(function(){$(this).parent().parent().addClass("draggable-item-hover")}).mouseleave(function(){$(this).parent().parent().removeClass("draggable-item-hover")}),$(".swimlanes-table tbody").sortable({forcePlaceholderSize:!0,handle:"td:first i",helper:function(t,e){return e.children().each(function(){$(this).width($(this).width())}),e},stop:function(e,i){var o=i.item;o.removeClass("draggable-item-selected"),t.savePosition(o.data("swimlane-id"),o.index()+1)},start:function(t,e){e.item.addClass("draggable-item-selected")}}).disableSelection()},Jitamin.Swimlane.prototype.savePosition=function(t,e){var i=$(".swimlanes-table").data("save-position-url"),o=this;this.app.showLoadingIcon(),$.ajax({cache:!1,url:i,contentType:"application/json",type:"POST",processData:!1,data:JSON.stringify({swimlane_id:t,position:e}),complete:function(){o.app.hideLoadingIcon()}})},Jitamin.Task=function(t){this.app=t},Jitamin.Task.prototype.keyboardShortcuts=function(){var t=$("#task-view"),e=this;this.app.hasId("task-view")&&(Mousetrap.bind("e",function(){e.app.get("Popover").open(t.data("edit-url"))}),Mousetrap.bind("c",function(){e.app.get("Popover").open(t.data("comment-url"))}),Mousetrap.bind("s",function(){e.app.get("Popover").open(t.data("subtask-url"))}),Mousetrap.bind("l",function(){e.app.get("Popover").open(t.data("internal-link-url"))}))},Jitamin.Task.prototype.onPopoverOpened=function(){var t=this,e=0;t.renderPickers(),$(document).on("click",".assign-me",function(t){var e=$(this).data("current-id"),i="#"+$(this).data("target-id");t.preventDefault(),$(i+" option[value="+e+"]").length&&$(i).val(e)}),$(document).on("change","select.task-reload-project-destination",function(){if(e>0)$(this).val(e);else{e=$(this).val();var i=$(this).data("redirect").replace(/PROJECT_ID/g,e);$(".loading-icon").show(),$.ajax({type:"GET",url:i,success:function(i,o,a){e=0,$(".loading-icon").hide(),t.app.get("Popover").ajaxReload(i,a,t.app.get("Popover"))}})}})},Jitamin.Task.prototype.renderPickers=function(){function t(t){return $('<div class="color-picker-option"><div class="color-picker-rectangle color-'+t.id+'">'+t.text+"</div></div>")}function e(t){return $('<div class="priority-picker-option"><div class="priority-picker-circle color-priority-'+t.id+'"></div><div class="priority-picker-label">'+t.text+"</div></div>")}$(".color-picker").select2({minimumResultsForSearch:1/0,templateResult:t,templateSelection:t}),$(".priority-picker").select2({minimumResultsForSearch:1/0,templateResult:e,templateSelection:e})},Jitamin.TaskTimeColumnChart=function(t){this.app=t},Jitamin.TaskTimeColumnChart.prototype.execute=function(){this.app.hasId("analytic-task-time-column")&&this.show()},Jitamin.TaskTimeColumnChart.prototype.show=function(){for(var t=$("#chart"),e=t.data("metrics"),i=[t.data("label")],o=[],a=0;a<e.length;a++)i.push(e[a].time_spent),o.push(e[a].title);c3.generate({data:{columns:[i],type:"bar"},bar:{width:{ratio:.5}},axis:{x:{type:"category",categories:o},y:{tick:{format:this.app.formatDuration}}},legend:{show:!1}})},Jitamin.Tooltip=function(t){this.app=t},Jitamin.Tooltip.prototype.onBoardRendered=function(){this.execute()},Jitamin.Tooltip.prototype.execute=function(){$(".tooltip").tooltip({track:!1,show:!1,hide:!1,position:{my:"left-20 top",at:"center bottom+9",using:function(t,e){$(this).css(t);var i=e.target.left+e.target.width/2-e.element.left-20;$("<div>").addClass("tooltip-arrow").addClass(e.vertical).addClass(i<1?"align-left":"align-right").appendTo(this)}},content:function(){var t=this,e=$(this).attr("data-href");return e?($.get(e,function(e){var i=$(".ui-tooltip:visible");$(".ui-tooltip-content:visible").html(e),i.css({top:"",left:""}),i.children(".tooltip-arrow").remove();var o=$(t).tooltip("option","position");o.of=$(t),i.position(o)}),'<i class="fa fa-spinner fa-spin"></i>'):'<div class="markdown">'+$(this).attr("title")+"</div>"}}).on("mouseenter",function(){var t=this;$(this).tooltip("open"),$(".ui-tooltip").on("mouseleave",function(){$(t).tooltip("close")})}).on("mouseleave focusout",function(t){t.stopImmediatePropagation();var e=this;setTimeout(function(){$(".ui-tooltip:hover").length||$(e).tooltip("close")},100)})},Jitamin.BoardDragAndDrop=function(t){this.app=t,this.savingInProgress=!1},Jitamin.BoardDragAndDrop.prototype.execute=function(){this.app.hasId("board")&&(this.dragAndDrop(),this.executeListeners())},Jitamin.BoardDragAndDrop.prototype.dragAndDrop=function(){var t=this,e=$(".board-task-list"),i={forcePlaceholderSize:!0,tolerance:"pointer",connectWith:".sortable-column",placeholder:"draggable-placeholder",items:".draggable-item",stop:function(e,i){var o=i.item,a=o.attr("data-task-id"),n=o.attr("data-position"),r=o.attr("data-column-id"),s=o.attr("data-swimlane-id"),l=o.parent().attr("data-column-id"),d=o.parent().attr("data-swimlane-id"),c=o.index()+1;o.removeClass("draggable-item-selected"),l==r&&d==s&&c==n||(t.changeTaskState(a),t.save(a,r,l,c,d))},start:function(t,e){e.item.addClass("draggable-item-selected"),e.placeholder.height(e.item.height())}};isMobile.any&&($(".task-board-sort-handle").css("display","inline"),i.handle=".task-board-sort-handle"),e.each(function(){$(this).css("min-height",$(this).parent().height())}),e.sortable(i)},Jitamin.BoardDragAndDrop.prototype.changeTaskState=function(t){var e=$("div[data-task-id="+t+"]");e.addClass("task-board-saving-state"),e.find(".task-board-saving-icon").show()},Jitamin.BoardDragAndDrop.prototype.save=function(t,e,i,o,a){var n=this;n.app.showLoadingIcon(),n.savingInProgress=!0,$.ajax({cache:!1,url:$("#board").data("store-url"),contentType:"application/json",type:"POST",processData:!1,data:JSON.stringify({task_id:t,src_column_id:e,dst_column_id:i,swimlane_id:a,position:o}),success:function(t){n.refresh(t),n.savingInProgress=!1},error:function(){n.app.hideLoadingIcon(),n.savingInProgress=!1},statusCode:{403:function(t){window.alert(t.responseJSON.message),document.location.reload(!0)}}})},Jitamin.BoardDragAndDrop.prototype.refresh=function(t){$("#board-container").replaceWith(t),this.app.hideLoadingIcon(),this.dragAndDrop(),this.executeListeners()},Jitamin.BoardDragAndDrop.prototype.executeListeners=function(){for(var t in this.app.controllers){var e=this.app.get(t);"function"==typeof e.onBoardRendered&&e.onBoardRendered()}},Vue.component("chart-project-task-distribution",{props:["metrics"],template:'<div id="chart"></div>',ready:function(){for(var t=[],e=0;e<this.metrics.length;e++)t.push([this.metrics[e].column_title,this.metrics[e].nb_tasks]);c3.generate({data:{columns:t,type:"donut"}})}}),Vue.component("chart-project-time-comparison",{props:["metrics","labelSpent","labelEstimated","labelClosed","labelOpen"],template:'<div id="chart"></div>',ready:function(){var t=[this.labelSpent],e=[this.labelEstimated],i=[];for(var o in this.metrics)t.push(this.metrics[o].time_spent),e.push(this.metrics[o].time_estimated),i.push("open"===o?this.labelOpen:this.labelClosed);c3.generate({data:{columns:[t,e],type:"bar"},bar:{width:{ratio:.2}},axis:{x:{type:"category",categories:i}},legend:{show:!0}})}}),Vue.component("chart-project-user-distribution",{props:["metrics"],template:'<div id="chart"></div>',ready:function(){for(var t=[],e=0;e<this.metrics.length;e++)t.push([this.metrics[e].user,this.metrics[e].nb_tasks]);c3.generate({data:{columns:t,type:"donut"}})}}),Vue.component("submit-cancel",{props:["labelButton","labelOr","labelCancel","callback"],template:'<div class="form-actions"><button type="button" class="btn btn-blue" @click="onSubmit" :disabled="isLoading"><span v-show="isLoading"><i class="fa fa-spinner fa-pulse"></i> </span>{{ labelButton }}</button> {{ labelOr }} <a href="#" v-on:click.prevent="onCancel">{{ labelCancel }}</a></div>',data:function(){return{loading:!1}},computed:{isLoading:function(){return this.loading}},methods:{onSubmit:function(){this.loading=!0,this.callback()},onCancel:function(){_HJ.get("Popover").close()}},events:{submitCancelled:function(){this.loading=!1}}}),Vue.component("task-move-position",{props:["board","saveUrl"],template:"#template-task-move-position",data:function(){return{swimlaneId:0,columnId:0,position:1,columns:[],tasks:[],positionChoice:"before",errorMessage:""}},ready:function(){this.columns=this.board[0].columns,this.columnId=this.columns[0].id,this.tasks=this.columns[0].tasks,this.errorMessage=""},methods:{onChangeSwimlane:function(){var t=this;this.columnId=0,this.position=1,this.columns=[],this.tasks=[],this.positionChoice="before",this.board.forEach(function(e){e.id===t.swimlaneId&&(t.columns=e.columns,t.tasks=t.columns[0].tasks,t.columnId=t.columns[0].id)})},onChangeColumn:function(){var t=this;this.position=1,this.tasks=[],this.positionChoice="before",this.columns.forEach(function(e){e.id==t.columnId&&(t.tasks=e.tasks,t.tasks.length>0&&(t.position=parseInt(t.tasks[0].position)))})},onSubmit:function(){var t=this;"after"==this.positionChoice&&this.position++,$.ajax({cache:!1,url:this.saveUrl,contentType:"application/json",type:"POST",processData:!1,data:JSON.stringify({column_id:this.columnId,swimlane_id:this.swimlaneId,position:this.position}),statusCode:{200:function(){window.location.reload(!0)},403:function(e){var i=JSON.parse(e.responseText);t.errorMessage=i.message,t.$broadcast("submitCancelled")}}})}}}),HJ.component("text-editor",function(t,e){function i(){var t=HJ.el("div").attr("class","text-editor-toolbar")["for"]("a",[{href:"#",html:'<i class="fa fa-pencil-square-o fa-fw"></i> '+e.labelWrite,click:function(){a()}}]).build();return f=HJ.el("div").attr("class","text-editor-preview-area markdown").build(),HJ.el("div").attr("class","text-editor-view-mode").add(t).add(f).hide().build()}function o(){var t=HJ.el("div").attr("class","text-editor-toolbar")["for"]("a",[{href:"#",html:'<i class="fa fa-eye fa-fw"></i> '+e.labelPreview,click:function(){a()}},{href:"#",html:'<i class="fa fa-bold fa-fw"></i>',click:function(){s("**")}},{href:"#",html:'<i class="fa fa-italic fa-fw"></i>',click:function(){s("_")}},{href:"#",html:'<i class="fa fa-strikethrough fa-fw"></i>',click:function(){s("~~")}},{href:"#",html:'<i class="fa fa-quote-right fa-fw"></i>',click:function(){d("> ")}},{href:"#",html:'<i class="fa fa-list-ul fa-fw"></i>',click:function(){d("* ")}},{href:"#",html:'<i class="fa fa-code fa-fw"></i>',click:function(){l("```")}}]).build();return u=HJ.el("textarea").attr("name",e.name).attr("tabindex",e.tabindex||"-1").attr("required",e.required||null).text(e.text).attr("autofocus",e.autofocus||null).attr("placeholder",e.placeholder||null).build(),HJ.el("div").attr("class","text-editor-write-mode").add(t).add(u).build()}function a(){HJ.el(f).html(marked(u.value,{sanitize:!0})),HJ.el(h).toggle(),HJ.el(m).toggle()}function n(){return u.value.substring(u.selectionStart,u.selectionEnd)}function r(t,e,i,o){return t.substring(0,e)+o+t.substring(i)}function s(t){var e=n();c(t+e+t),p(t)}function l(t){var e=n();c("\n"+t+"\n"+e+"\n"+t),p(t,2)}function d(t){var e=n();if(e.indexOf("\n")===-1)c("\n"+t+e);else{for(var i=e.split("\n"),o=0;o<i.length;o++)i[o].indexOf(t)===-1&&(i[o]=t+i[o]);c(i.join("\n"))}}function c(t){var e=!1;if(g=u.selectionStart,v=u.selectionEnd,u.focus(),document.queryCommandSupported("insertText")&&(e=document.execCommand("insertText",!1,t)),!e){try{document.execCommand("ms-beginUndoUnit")}catch(i){}u.value=r(text,u.selectionStart,u.selectionEnd,t);try{document.execCommand("ms-endUndoUnit")}catch(i){}}}function p(t,e){e=e||0;var i=v+t.length+e;u.setSelectionRange(i,i)}var u,h,m,f,g,v;this.render=function(){m=o(),h=i(),t.appendChild(HJ.el("div").attr("class","text-editor").add(h).add(m).build())}});var _HJ=null;jQuery(document).ready(function(){_HJ=new Jitamin.App,_HJ.execute(),HJ.render()});